import{a as f}from"./axios-DBFezj-0.js";$(function(){isDarkStyle?(config.colors_dark.borderColor,config.colors_dark.bodyBg,config.colors_dark.headingColor):(config.colors.borderColor,config.colors.bodyBg,config.colors.headingColor),$(document).on("click",".remove-expired-users",function(){Swal.fire({title:"هشدار!",text:"پس از حذف کاربر دیگر قابلیت بازگشت عملیات وجود ندارد",icon:"warning",showCancelButton:!0,confirmButtonText:"حذف کن!",cancelButtonText:"لغو",customClass:{confirmButton:"btn btn-primary me-2 waves-effect waves-light",cancelButton:"btn btn-label-secondary waves-effect waves-light"},buttonsStyling:!1}).then(function(t){t.value?($.blockUI({message:'<div class="d-flex justify-content-center"><p class="mb-0 mx-2">منتظر بمانید...</p> <div class="sk-wave m-0"><div class="sk-rect sk-wave-rect"></div> <div class="sk-rect sk-wave-rect"></div> <div class="sk-rect sk-wave-rect"></div> <div class="sk-rect sk-wave-rect"></div> <div class="sk-rect sk-wave-rect"></div></div> </div>',css:{backgroundColor:"transparent",color:"#fff",border:"0"},overlayCSS:{opacity:.8}}),f.delete("/api/users/remove-expired",{headers:{Authorization:`Bearer ${window.apiToken}`,"Content-Type":"application/json"}}).then(a=>{$.unblockUI(),Swal.fire({icon:"success",title:"حذف شد!",text:"کاربر مورد نظر به همراه حذف شد",confirmButtonText:"باشه",customClass:{confirmButton:"btn btn-success waves-effect waves-light"}}).then(function(e){window.location.href="/app/user/list"})}).catch(a=>{$.unblockUI(),$(".wizard-icons-invoice").block({message:'<p class="mb-0">عملیات نا موفق</p><div>'+JSON.stringify(a)+"</div>",timeout:3e3,css:{backgroundColor:"transparent",color:"#fff",border:"0"},overlayCSS:{opacity:.25}})})):(t.dismiss,Swal.DismissReason.cancel)})});var n=$(".datatables-users"),o=$(".select2");if(baseUrl+"",o.length){var i=o;i.wrap('<div class="position-relative"></div>').select2({placeholder:"انتخاب کشور",dropdownParent:i.parent()})}if(n.length)var d=n.DataTable({ajax:{url:"/api/admins",type:"GET",beforeSend:function(t){t.setRequestHeader("Authorization","Bearer "+window.apiToken)}},columns:[{data:""},{data:"id"},{data:"id"},{data:"id"},{data:"id"},{data:"id"},{data:"id"},{data:"id"},{data:"id"},{data:"id"}],columnDefs:[{className:"control",searchable:!1,orderable:!1,responsivePriority:2,targets:0,render:function(t,a,e,r){return""}},{targets:1,responsivePriority:4,render:function(t,a,e,r){return console.log(e),e.username}},{targets:2,render:function(t,a,e,r){return e.internet_type}},{targets:3,render:function(t,a,e,r){return e.password}},{targets:4,render:function(t,a,e,r){return e.active_sessions}},{targets:5,render:function(t,a,e,r){return`${e.sub_days} روز`}},{targets:6,render:function(t,a,e,r){const s=e.sub_days,l=new Date(e.start_sub_date),m=new Date-l,u=parseInt(m/(1e3*60*60*24))||0,c=s-u;return c>0?`${c} روز`:'<span class="badge bg-label-danger">اعتبار تمام شده است</span>'}},{targets:7,render:function(t,a,e,r){return e.max_volume}},{targets:8,render:function(t,a,e,r){return e.current_volume}},{targets:-1,title:"عملیات",searchable:!1,orderable:!1,render:function(t,a,e,r){var s=`/app/user/${e.id}`;return`<div class="d-flex align-items-center"><a href="javascript:;" class="text-body dropdown-toggle hide-arrow" data-bs-toggle="dropdown"><i class="ti ti-dots-vertical ti-sm mx-1"></i></a><div class="dropdown-menu dropdown-menu-end m-0"><a href="${s}" class="dropdown-item">ویرایش</a><a href="${s}/delete" class="dropdown-item">حذف کاربر</a><a href="${s}/resetVolume" class="dropdown-item">تمدید حجم</a><a href="${s}/resetDays" class="dropdown-item">تمدید اعتبار</a><a href="${s}/removeActiveSessions" class="dropdown-item">حذف سشن های فعال</a></div></div>`}}],order:[[1,"desc"]],dom:'<"row me-2"<"col-md-2"<"me-3"l>><"col-md-10"<"dt-action-buttons text-xl-end text-lg-start text-md-end text-start d-flex align-items-center justify-content-end flex-md-row flex-column mb-3 mb-md-0"fB>>>t<"row mx-2"<"col-sm-12 col-md-6"i><"col-sm-12 col-md-6"p>>',language:{url:assetsPath+"json/i18n/datatables-bs5/fa.json",sLengthMenu:"_MENU_",search:"",searchPlaceholder:"جستجو.."},buttons:[{text:'<i class="ti ti-trash me-0 me-sm-1 ti-xs"></i><span class="d-none d-sm-inline-block">حذف کاربران منقضی شده</span>',className:"add-new btn btn-outline-danger waves-effect waves-light mx-3 remove-expired-users"},{text:'<i class="ti ti-plus me-0 me-sm-1 ti-xs"></i><span class="d-none d-sm-inline-block">افزودن کاربر</span>',className:"add-new btn btn-primary waves-effect waves-light mx-3",attr:{"data-bs-toggle":"offcanvas","data-bs-target":"#offcanvasAddUser"}}],responsive:{details:{display:$.fn.dataTable.Responsive.display.modal({header:function(t){var a=t.data();return"جزئیات "+a.name}}),type:"column",renderer:function(t,a,e){var r=$.map(e,function(s,l){return s.title!==""?'<tr data-dt-row="'+s.rowIndex+'" data-dt-column="'+s.columnIndex+'"><td>'+s.title+":</td> <td>"+s.data+"</td></tr>":""}).join("");return r?$('<table class="table"/><tbody />').append(r):!1}}}});$(".datatables-users tbody").on("click",".delete-record",function(){d.row($(this).parents("tr")).remove().draw()}),setTimeout(()=>{$(".dataTables_filter .form-control").removeClass("form-control-sm"),$(".dataTables_length .form-select").removeClass("form-select-sm")},300)});(function(){const n=document.querySelectorAll(".phone-mask"),o=document.getElementById("addNewUserForm");n&&n.forEach(function(i){new Cleave(i,{phone:!0})}),FormValidation.formValidation(o,{fields:{username:{validators:{notEmpty:{message:"نام کامل را وارد کنید"}}},password:{validators:{notEmpty:{message:"رمز عبور را وارد کنید"},stringLength:{min:8,message:"رمز عبور باید حداقل 8 کاراکتر باشد"}}},repassword:{validators:{notEmpty:{message:"تایید رمز عبور را وارد کنید"},identical:{compare:function(){return o.querySelector('[name="password"]').value},message:"رمز عبور و تایید آن یکسان نیستند"}}},max_active_session:{validators:{notEmpty:{message:"تعداد نشست‌های فعال را وارد کنید"},numeric:{message:"این فیلد باید یک عدد باشد"},between:{min:1,message:"تعداد نشست‌های فعال باید حداقل 1 باشد"}}},max_volume:{validators:{notEmpty:{message:"حجم مجاز را وارد کنید"},numeric:{message:"این فیلد باید یک عدد باشد"},between:{min:0,message:"حجم مجاز باید حداقل 0 باشد"}}},sub_days:{validators:{notEmpty:{message:"تعداد روز های اشتراک را وارد کنید"},numeric:{message:"این فیلد باید یک عدد باشد"},between:{min:1,message:"تعداد روز های مجاز باید حداقل 1 باشد"}}}},plugins:{trigger:new FormValidation.plugins.Trigger,bootstrap5:new FormValidation.plugins.Bootstrap5({eleValidClass:"",rowSelector:function(i,d){return".mb-3"}}),autoFocus:new FormValidation.plugins.AutoFocus}})})();
